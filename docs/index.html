<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BELOURA | Rastreo de paquetes</title>
  <meta name="color-scheme" content="light dark" />
  <link rel="icon" href="/favicon.ico" />
  <style>
    :root{
      --bg:#050814;
      --bg2:#070b18;
      --panel:#0b0f1e;
      --panel-soft:#0f1524;
      --muted:#9aa4ae;
      --text:#f5f7fb;
      --primary:#0056ff;
      --primary-soft:#1a4dff;
      --accent:#00bfa6;
      --border:#1c2335;
      --chip:#10182a;
      --shadow: 0 1px 2px rgba(0,0,0,.35), 0 16px 40px rgba(0,0,0,.55);
      --radius-xl: 22px;
      --radius-md: 14px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      background:radial-gradient(circle at top,#0f172a 0,#050814 55%,#020617 100%);
      color:var(--text);
      font:16px/1.5 system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Inter,Ubuntu,Arial,sans-serif;
    }
    a{color:var(--accent);text-decoration:none}
    a:hover{text-decoration:underline}
    .wrap{max-width:1020px;margin:auto;padding:24px 18px 32px}

    /* Header */
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      margin-bottom:18px;
    }
    .brand{
      display:flex;
      align-items:center;
      gap:10px;
      min-width:0;
    }
    .brand-logo{
      width:40px;
      height:40px;
      border-radius:999px;
      background:radial-gradient(circle at 30% 20%,#3b82f6 0,#1d4ed8 30%,#020617 70%);
      display:grid;
      place-items:center;
      box-shadow:0 0 0 2px rgba(15,23,42,.7);
      overflow:hidden;
    }
    .brand-logo img{
      max-width:32px;
      max-height:32px;
      display:block;
    }
    .brand-text{
      display:flex;
      flex-direction:column;
    }
    .brand-text span:first-child{
      font-size:18px;
      font-weight:800;
      letter-spacing:.06em;
      text-transform:uppercase;
    }
    .brand-text span:last-child{
      font-size:13px;
      color:var(--muted);
    }
    .tagline{
      font-size:13px;
      color:var(--muted);
      text-align:right;
    }

    /* Panels */
    .panel{
      background:linear-gradient(145deg,rgba(15,23,42,.85),rgba(15,23,42,.95));
      border:1px solid rgba(30,64,175,.5);
      border-radius:var(--radius-xl);
      box-shadow:var(--shadow);
      padding:18px 18px 20px;
    }
    .hero-title{
      margin:0;
      font-size:28px;
      font-weight:800;
      letter-spacing:.02em;
    }
    .hero-sub{
      margin:6px 0 0;
      color:var(--muted);
      font-size:14px;
    }
    .hero-sub b{color:var(--accent);font-weight:600}

    /* Search */
    .search{
      display:grid;
      grid-template-columns:1fr auto;
      gap:10px;
      margin-top:18px;
    }
    .input{
      padding:14px 14px;
      border-radius:16px;
      border:1px solid var(--border);
      background:radial-gradient(circle at top,rgba(30,64,175,.35),rgba(15,23,42,1));
      color:var(--text);
      outline:none;
    }
    .input::placeholder{color:#6b7280}
    .input:focus{
      border-color:var(--primary);
      box-shadow:0 0 0 3px rgba(37,99,235,.4);
    }
    .btn{
      cursor:pointer;
      border-radius:999px;
      border:1px solid #1d4ed8;
      background:linear-gradient(135deg,var(--primary),var(--primary-soft));
      color:#fff;
      padding:13px 22px;
      font-weight:700;
      letter-spacing:.03em;
      text-transform:uppercase;
      font-size:13px;
    }
    .btn:active{transform:translateY(1px)}
    .btn:disabled{
      opacity:.55;
      cursor:default;
      transform:none;
    }

    /* KPI cards */
    .section{margin-top:20px}
    .kpi-grid{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:14px;
    }
    .kpi{
      border-radius:var(--radius-md);
      background:linear-gradient(145deg,var(--panel),var(--panel-soft));
      border:1px solid rgba(30,64,175,.6);
      padding:14px 16px;
      display:flex;
      align-items:center;
      gap:12px;
    }
    .kpi-icon{
      width:38px;
      height:38px;
      border-radius:14px;
      background:radial-gradient(circle at 20% 20%,rgba(59,130,246,.9),rgba(15,23,42,1));
      display:grid;
      place-items:center;
      border:1px solid rgba(191,219,254,.6);
    }
    .kpi-main{display:flex;flex-direction:column}
    .kpi-main h3{
      margin:0;
      font-size:13px;
      text-transform:uppercase;
      letter-spacing:.16em;
      color:var(--muted);
    }
    .kpi-main p{
      margin:3px 0 0;
      font-size:24px;
      font-weight:800;
    }

    /* Tables */
    .section h4{
      margin:0 0 10px;
      font-size:14px;
      color:var(--muted);
      text-transform:uppercase;
      letter-spacing:.24em;
    }
    .table-wrap{
      border-radius:var(--radius-md);
      border:1px solid var(--border);
      background:radial-gradient(circle at top left,#020617,#020617);
      padding:4px 2px;
      box-shadow:0 10px 32px rgba(0,0,0,.55);
    }
    table{width:100%;border-collapse:collapse}
    th,td{
      padding:11px 14px;
      border-bottom:1px dashed #1f2937;
      font-size:14px;
      text-align:left;
    }
    th{color:var(--muted);font-weight:600}
    tr:last-child td{border-bottom:none}
    .muted{color:var(--muted)}
    .empty{
      border-radius:var(--radius-md);
      border:1px dashed var(--border);
      padding:14px 16px;
      text-align:center;
      color:var(--muted);
      background:rgba(15,23,42,.7);
    }

    footer{
      margin:28px 0 4px;
      text-align:center;
      font-size:13px;
      color:var(--muted);
    }

    @media (max-width:760px){
      .wrap{padding:18px 14px 28px}
      header{flex-direction:column;align-items:flex-start}
      .tagline{text-align:left}
      .hero-title{font-size:22px}
      .kpi-grid{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="brand-logo">
          <!-- Cambia la ruta por la de tu logo real -->
          <img src="/img/logo.png" alt="Beloura" />
        </div>
        <div class="brand-text">
          <span>BELOURA</span>
          <span>Rastreo de paqueter√≠a</span>
        </div>
      </div>
      <div class="tagline">
        Consulta segura en l√≠nea<br>
        <span style="opacity:.8">Consulta tus pesos y estados</span>
      </div>
    </header>

    <!-- Hero / Buscador -->
    <section class="panel">
      <h1 class="hero-title">Rastrea tus paquetes</h1>
      <p class="hero-sub">
        Ingresa tu <b>c√≥digo de cliente</b> (ej. <code>BLR-ABC123</code>) para ver tus
        <b>libras pendientes</b>, <b>libras enviadas</b> y el detalle de cada paquete
        en tiempo real.
      </p>
      <div class="search">
        <input id="code" class="input" placeholder="Ej: BLR-ABC123" inputmode="latin" autocomplete="off" />
        <button class="btn" id="btnConsultar" onclick="consultar()">Consultar</button>
      </div>
    </section>

    <!-- Resultados -->
    <section id="result" class="section" style="display:none">
      <div id="nombreCliente" class="panel" style="margin-bottom:16px; text-align:center; font-weight:600; font-size:18px; color:#00bfa6;">
</div>
      <div class="kpi-grid">
        <div class="kpi">
          <div class="kpi-icon">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4 7h16M4 12h16M4 17h16" stroke="#bfdbfe" stroke-width="1.5"/>
            </svg>
          </div>
          <div class="kpi-main">
            <h3>Libras pendientes</h3>
            <p id="lbsPendientes">0.00</p>
          </div>
        </div>

        <div class="kpi">
          <div class="kpi-icon" style="background:radial-gradient(circle at 20% 20%,#22c55e,#065f46);border-color:#bbf7d0">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M5 12l4 4L19 6" stroke="#ecfdf5" stroke-width="2"/>
            </svg>
          </div>
          <div class="kpi-main">
            <h3>Libras enviadas</h3>
            <p id="lbsEnviadas">0.00</p>
          </div>
        </div>
      </div>

      <div class="section">
        <h4>Pendientes</h4>
        <div id="pendientes"></div>
      </div>

      <div class="section">
        <h4>Enviados</h4>
        <div id="enviados"></div>
      </div>
    </section>

    <!-- Estado inicial -->
    <section id="empty" class="section" style="display:none">
      <div class="panel empty">
        Ingresa tu c√≥digo para ver tus paquetes asociados.
      </div>
    </section>

    <footer>
      ¬© <span id="year"></span> BELOURA ‚Ä¢ 2025
    </footer>
  </div>

  <script>
    // üëâ REEMPLAZA esto por tu URL /exec de Apps Script
    const WEBAPP_URL = 'https://script.google.com/macros/s/AKfycbzp7dqjY-WR3labkHCZJ8B5DSQtUG4Ga9UrAGi7nU0qjsjeVWC5xLGjTSWGBpyVYntQfw/exec';

    const $ = s => document.querySelector(s);
    const fmtDate = s => {
      if(!s) return '';
      const d = new Date(s);
      return isNaN(d) ? s : d.toLocaleString();
    };

    const table = arr => (!arr || !arr.length)
      ? `<div class="empty">Sin registros a√∫n en esta secci√≥n.</div>`
      : `<div class="table-wrap"><div style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>Paquete</th>
                <th>Peso (lb)</th>
                <th>Estado</th>
                <th>Actualizado</th>
              </tr>
            </thead>
            <tbody>
              ${arr.map(p => `
                <tr>
                  <td>${p.pkg_code}</td>
                  <td>${(p.peso_lb ?? 0).toFixed ? p.peso_lb.toFixed(2) : p.peso_lb}</td>
                  <td>${p.estado}</td>
                  <td class="muted">${fmtDate(p.fecha_estado || p.fecha)}</td>
                </tr>`).join('')}
            </tbody>
          </table>
        </div></div>`;

    // JSONP helper (para evitar CORS)
    function jsonp(url, onSuccess, onError){
      const cbName = 'blr_cb_' + Math.random().toString(36).slice(2);
      let fired = false;
      window[cbName] = data => {
        fired = true;
        try { onSuccess(data); }
        finally {
          delete window[cbName];
          if (script && script.parentNode) script.parentNode.removeChild(script);
        }
      };
      const full = url + (url.includes('?') ? '&' : '?') + 'callback=' + cbName;
      const script = document.createElement('script');
      script.src = full;
      script.async = true;
      script.onerror = () => {
        if (script.parentNode) script.parentNode.removeChild(script);
        delete window[cbName];
        onError && onError(new Error('network_error'));
      };
      script.onload = () => {
        setTimeout(() => {
          if (!fired) {
            if (script.parentNode) script.parentNode.removeChild(script);
            delete window[cbName];
            onError && onError(new Error('no_callback_executed'));
          }
        }, 0);
      };
      document.body.appendChild(script);
    }

    function show(id, on){ $(id).style.display = on ? 'block' : 'none'; }

    function render(data, code){
      if(!data || !data.ok){
        $('#pendientes').innerHTML = `<div class="empty">No se encontraron registros para el c√≥digo <b>${code}</b>.</div>`;
        $('#enviados').innerHTML = '';
        $('#lbsPendientes').textContent = '0.00';
        $('#lbsEnviadas').textContent  = '0.00';
        show('#empty', false);
        show('#result', true);
        return;
      }
      localStorage.setItem('blr_code', code);
      $('#nombreCliente').textContent = data.cliente_nombre ? data.cliente_nombre : 'Cliente sin nombre registrado';
      $('#lbsPendientes').textContent = Number(data.lbs_pendientes || 0).toFixed(2);
      $('#lbsEnviadas').textContent  = Number(data.lbs_enviadas   || 0).toFixed(2);
      $('#pendientes').innerHTML = table(data.pendientes || []);
      $('#enviados').innerHTML   = table(data.enviados   || []);
      show('#empty', false);
      show('#result', true);
    }

    function consultar(){
      const code = $('#code').value.trim();
      if(!code){
        show('#result', false);
        show('#empty', true);
        return;
      }
      const btn = $('#btnConsultar');
      const old = btn.textContent;
      btn.textContent = 'Consultando‚Ä¶';
      btn.disabled = true;

      const url = `${WEBAPP_URL}?path=api/track&code=${encodeURIComponent(code)}`;
      jsonp(url,
        resp => { render(resp, code); btn.textContent = old; btn.disabled = false; },
        err  => {
          console.error(err);
          alert('Error consultando el servicio. Intenta de nuevo en unos segundos.');
          btn.textContent = old;
          btn.disabled = false;
        }
      );
    }

    const getQ = name => new URLSearchParams(location.search).get(name);

    document.addEventListener('DOMContentLoaded', ()=>{
      $('#year').textContent = new Date().getFullYear();
      const q = getQ('code') || localStorage.getItem('blr_code');
      if(q){ $('#code').value = q; consultar(); } else { show('#empty', true); }
      $('#code').addEventListener('keydown', e => { if(e.key === 'Enter') consultar(); });
    });
  </script>
</body>
</html>
